<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">

    <link rel="stylesheet" href="/queue.css">
    <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <!--<script src="jquery.tools.1.2.6.min.js"></script>-->

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <script src="/queue_util.js"></script>
    <script src="/queue_dev.js"></script>

    <title>OH Queue</title>
    <meta name="author" content="James Juett" />
    <meta name="google-signin-client_id" content="355743019649-mrm7gtmkujj5gicc4rftl0ckm959ui7d.apps.googleusercontent.com">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        #signupMessage{
            color: red;
        }

        #signupMessage.ok {
            color: inherit;
        }
    </style>
</head>

<!--Hi Mom! All operations are validated on the serverside. Don't waste your time. :) -->

<body>
<div class="page-header" style="text-align: center;">
    <h3>EECS Office Hours</h3>
    <div style="display: inline-block;">
        <div class="g-signin2" data-onsuccess="onSignIn"></div>
    </div>
    <h5 id="accountMessage" class="text-danger"></h5>
</div>


<div id="queueApplication">
    <div class="container">
        <div class="row">
            <div class="col-xs-3 col-md-2">
                <ul class="coursePills nav nav-pills nav-stacked"></ul>
            </div>
            <div class="coursePanes col-xs-9 col-md-10 tab-content"></div>
        </div>
    </div>
</div>

<!-- modal dialog for clearing the queue -->
<div id="errorDialog" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Oops</h4>
            </div>
            <div class="modal-body" style="text-align: center">
                <p>Something went wrong. (Probably your id token from Google expired.)</p>
                <p>Try refreshing the page.</p>
            </div>
        </div>

    </div>
</div>

<!-- modal dialog for clearing the queue -->
<div id="clearTheQueueDialog" class="modal fade adminOnly" role="dialog">
    <div class="modal-dialog">
        <!-- Modal content-->
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Clear the queue?</h4>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <label for="clearInput">Enter "clear" to clear ALL requests from the queue. (DO NOT use this to clear single requests - what if another one has been submitted but the page hasn't refreshed?")</label>
                        <input type="text" class="form-control" id="clearInput" placeholder="clear">
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>

<!-- modal dialog for signing up -->
<div id="signUpDialog" class="modal fade" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Sign up and we'll be with you ASAP!</h4>
            </div>
            <div class="modal-body">
                <form id = "signUpForm" role="form" class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="signUpName">Name:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="signUpName" required = "required" maxlength="30" placeholder="Nice to meet you!">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="signUpLocation">Location:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="signUpLocation" required = "required" maxlength="50" placeholder="e.g. Computer #36, laptop by door, etc.">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label col-sm-2" for="signUpDescription">Description:</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" id="signUpDescription" required = "required" maxlength="100" placeholder="Tell us a bit about your question(s).">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id="signUpButton" type="submit" class="btn btn-default">Sign Up</button>
                        </div>
                    </div>
                </form>
                <!--<form role="form">-->
                    <!--<div class="form-group">-->
                        <!--<label for="clearInput">Enter "clear" to clear ALL requests from the queue.</label>-->
                        <!--<input type="text" class="form-control" id="clearInput" placeholder="clear">-->
                    <!--</div>-->
                <!--</form>-->
            </div>
        </div>

    </div>
</div>

<!--<div style="width:500px; margin-left: auto; margin-right: auto">-->

    <!--<ul id="queueList" class="list-group"></ul>-->
<!--</div>-->


<script>

    function onSignIn(googleUser) {
        var profile = googleUser.getBasicProfile();
//        console.log('Name: ' + profile.getName());
//        console.log('Image URL: ' + profile.getImageUrl());
//        console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
        User.signIn(profile.getEmail(), googleUser.getAuthResponse().id_token);
    }

    $(document).ready(function() {
        setupDialogs();

        QueueApplication.createTarget($("#queueApplication"));
        User.setTarget(UnauthenticatedUser.instance());

        // Recurring refresh
        setInterval(function(){
            QueueApplication.refreshActiveQueue();
        }, 4000);

    });

    function setupDialogs() {
        var clearInput = $("#clearInput");
        var clearTheQueueDialog = $("#clearTheQueueDialog");
        clearTheQueueDialog.on('shown.bs.modal', function () {
            clearInput.focus();
        });
        clearTheQueueDialog.on('show.bs.modal', function () {
            clearInput.val("");
        });
        clearInput.on("input", function(e){
            if ($(this).val() == "clear"){
                clearTheQueueDialog.modal("hide");
                QueueApplication.activeQueue().clear();
            }
        });

        var signUpDialog = $("#signUpDialog");
        signUpDialog.on('show.bs.modal', function () {
            $(this).find("input").val("");
        });
        signUpDialog.on('shown.bs.modal', function () {
            $(this).find("input:first").focus();
        });

        $("#signUpForm").submit(function(e){
            e.preventDefault();
            var signUpName = $("#signUpName").val();
            var signUpLocation = $("#signUpLocation").val();
            var signUpDescription = $("#signUpDescription").val();

            if (!signUpName || signUpName.length == 0 ||
                    !signUpLocation || signUpLocation.length == 0 ||
                    !signUpDescription || signUpDescription.length == 0){
                alert("You must fill out all the fields.");
                return false;
            }

            QueueApplication.activeQueue().signUp(
                    signUpName,
                    signUpLocation,
                    signUpDescription);

            signUpDialog.modal("hide");
            return false;
        });
    }


</script>
</body>
</html>
