<!DOCTYPE html>
<!--suppress ALL -->
<html lang="en">
<head>
    <meta charset="utf-8" />

    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>-->
    <script src="js/lib/codemirror.js"></script>
    <script src="js/lib/clike.js"></script>
    <script src="js/lib/jquery-3.1.1.min.js"></script>
    <script src="js/lib/jquery.mousewheel.min.js"></script>
    <script src="js/lib/peg-0.10.0.min.js"></script>
    <script src="js/lib/svg.min.js"></script>
    <script src="js/lib/seedrandom.js"></script>
    <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
    Remove this if you use the .htaccess -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Lobster</title>
    <meta name="description" content="" />
    <meta name="author" content="James" />
    <meta name="google-signin-client_id" content="355743019649-mrm7gtmkujj5gicc4rftl0ckm959ui7d.apps.googleusercontent.com">

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="stylesheet" href="/bootstrap/css/bootstrap.css">
    <link rel="stylesheet" href="css/buttons.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/code.css">
    <link rel="stylesheet" href="css/regression.css">
    <link href="https://fonts.googleapis.com/css?family=Muli" rel="stylesheet">

    <script src = "js/lib/diff_match_patch.js"></script>
    <script src = "js/lib/underscore-min.js"></script>
    <script src = "js/lib/math.min.js"></script>
    <script src = "js/util/util.js"></script>
    <script src = "js/util/entities.js"></script>
    <script src = "js/util/outlet.js"></script>
    <script src = "js/core/internals.js"></script>
    <script src = "js/view/annotations.js"></script>
    <script src = "js/core/error.js"></script>
    <script src = "js/core/types.js"></script>
    <script src = "js/core/expressions.js"></script>
    <script src = "js/core/standardConversions.js"></script>
    <script src = "js/core/declarations.js"></script>
    <script src = "js/core/initializers.js"></script>
    <script src = "js/core/statements.js"></script>
    <script src = "js/core/constructsAfter.js"></script>
    <script src = "js/core/Program.js"></script>
    <script src = "js/core/Simulation.js"></script>
    <script src = "js/view/actions.js"></script>
    <script src = "js/view/simOutlets.js"></script>
    <script src = "js/view/codeOutlets.js"></script>
    <script src = "js/core/parsing.js"></script>
    <script src = "js/core/parsing2.js"></script>
    <script src = "js/core/analysis.js"></script>
    <script src = "js/core/regression.js"></script>

</head>

<body>


<div class="page-header" style="margin-top: 5px; margin-bottom: 5px; padding-bottom: 5px">
    <div class="container-fluid">
        <h4 style="display: inline-block; vertical-align: middle;">Lobster Regression Tests: <span id="allTestsResults"></span></h4>
        <!--<h5 id="accountMessage" class="text-danger" style="float: right; margin-left: 5px; margin-right: 5px">Sign Out</h5>-->
    </div>
</div>

<div id="regression_tests">

</div>

    <script>

        var numTests = 0;
        var numTestsSuccessful = 0;

        var showTest = function(test) {
            var programElem = $('<div class="col-xs-6"></div>');

            programElem.append("Translation Units: <br />");
            for(var name in test.program.getTranslationUnits()) {
                programElem.append("<code>" + name + "</code><br />");
            }

            programElem.append("Source Files: <br />");
            var filesElem = $("<pre></pre>");
            filesElem.hide();
            var showFilesButton = $('<button class="btn btn-primary">Show</button>');
            showFilesButton.click(function() {
                showFilesButton.html(showFilesButton.html() === "Show" ? "Hide" : "Show");
                filesElem.toggle();
            });
            programElem.append(showFilesButton);
            for (var name in test.program.getSourceFiles()) {
                var sourceFile = test.program.getSourceFiles()[name];
                filesElem.append(sourceFile.getName() + "\n" + sourceFile.getText());
            }
            programElem.append(filesElem);


            var resultsElem = $('<div class="col-xs-6"></div>');
//            resultsElem.append(test.results.status);
//            resultsElem.append("<br />");
            var success = true;
            for(var i = 0; i < test.results.length; ++i) {
                var result = test.results[i];

                var statusElem = $("<span class='label'>"+result.status+"</span>");
                statusElem.addClass(result.status === "success" ? "label-success" : "label-danger");
                resultsElem.append(statusElem);
                resultsElem.append(" " + result.verifierName);
                resultsElem.append("<br />");
                resultsElem.append(result.message + "<br />");

                if (result.status !== "success") {
                    success = false;
                }
            }

            var testElem = $('<div class="container lobster-test-result"></div>');
            testElem.append("<h2>" + test.name + "</h2>");
            testElem.append(programElem);
            testElem.append(resultsElem);
            $("#regression_tests").append(testElem);

            ++numTests;
            if (success) {
                ++numTestsSuccessful;
            }
            $("#allTestsResults").html(numTestsSuccessful + "/" + numTests + " tests successful")
        };

        ProgramTest.setDefaultReporter(showTest);

        // Empty program


        // Empty main
        SingleTranslationUnitTest.instance(
            "Empty Main",
            "int main() { }",
            [
                NoErrorsNoWarningsVerifier.instance(),
                NoBadRuntimeEventsVerifier.instance()
            ]
        );

        // ---------- Basic Declaration Tests ----------

        var basicDeclarationTestCode =
            `int main() {
  // A variety of declartions, including pointers and references
  int var = 3;
  int *ptr = &var;
  int **ptr2 = &ptr;
  int ***ptr3 = &ptr2;
  int &ref = var;
  int &ref2 = ref;
  int *&ref_to_ptr = ptr;
  int var2 = var;
  int var3 = *ptr;
  int var4 = **ptr2;
  int var5 = ref;
  int var6 = *ref_to_ptr;

  // Check that they all have the same value
  assert(var == 3);
  assert(var2 == 3);
  assert(var3 == 3);
  assert(var4 == 3);
  assert(var5 == 3);
  assert(var6 == 3);

  // Check that they have same/different addresses as they should
  assert(ptr == &var);
  assert(&ref == &var);
  assert(&ref2 == &ref);
  assert(&var2 != &var);
  assert(&ref_to_ptr == &ptr);
  assert(&ref_to_ptr == ptr2);

  // change via reference, check that the change is reflected everywhere
  ref = 4;
  assert(ref == 4);
  assert(var == 4);
  assert(*ptr == 4);
  assert(*ref_to_ptr == 4);

  // change via pointer, check that the change is reflected everywhere
  *ptr = 5;
  assert(ref == 5);
  assert(var == 5);
  assert(*ptr == 5);
  assert(*ref_to_ptr == 5);

  // test basic declaration of arrays
  int arr[3];
  int arr2[4] = {1, 2, 3, 99};
  int *ptrArr[2];
  int *ptrArr2[3] = {ptr, *ptr2, ref_to_ptr};
  assert(arr2[2] == 3);
  assert(ptrArr2[0] == &var);

  arr2[3] = *ptrArr2[2];
  assert(arr2[3] == var);

}`;
        var fundamentalTypesToTest = ["int", "double", "char"];
        fundamentalTypesToTest.map(function(t) {
            SingleTranslationUnitTest.instance(
                "Basic Declaration Test - " + t,
                basicDeclarationTestCode.replace(/int/g, t),
                [
                    NoErrorsNoWarningsVerifier.instance(),
                    NoBadRuntimeEventsVerifier.instance()
                ]
            );
        });

        // ---------- Basic Statement Test ----------

        SingleTranslationUnitTest.instance(
            "Basic Statement Test",
            `int main() {
  int x = 3;
  int y = 4;

  // Basic tests for all statements
  if (x == 3) {
    ++x;
  }
  assert(x == 4);

  if (y == 10) {
    assert(false);
  }
  else {
    assert(true);
  }

  int count = 0;
  while (y > 0) {
    --y;
    ++count;
  }
  assert(y == 0);
  assert(count == 4);

  for(int i = 0; i < 10; ++i) {
    ++y;
  }
  assert(y == 10);

  int z = 3;
  do {
    z++;
  }
  while(z == 4);
  assert(z == 5);

  int a = 5;
  while (a > 0) {
    --a;
    if (a < 3) {
      break;
    }
  }
  assert(a == 2);

  for(; a < 10; ++a) {
    if (a > 3) {
      if (a > 4) {
        if (a == 5) {
          break;
        }
      }
    }
  }
  assert(a == 5);

  // Expression statements
  ++x;
  x;
  cout << x;

  // Compound statement
  {
    int blah = x;
    x + 1;
    x = x + 1;
    assert(blah + 1 == x);
  }

}`,
            [
                NoErrorsNoWarningsVerifier.instance(),
                NoBadRuntimeEventsVerifier.instance()
            ]
        );


    </script>
</body>
</html>
