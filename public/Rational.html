<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<script src="jquery-1.8.3.min.js"></script>
		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<title>Code Visualization</title>
		<meta name="description" content="" />
		<meta name="author" content="James" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
		<link rel="stylesheet" href="css/main.css">

		<script src = "underscore-min.js"></script>
		<script src = "util.js"></script>
		<script src = "entities.js"></script>
		<script src = "outlet.js"></script>

	</head>

	<body>
		
		<div id="main_area" style = "left: 0px;">
			<div>
				<!-- <p class="title">
					C++ Interpreter Test
				</p> -->

				<textarea id="debug" style="display:none; width: 800px; height: 50px"> </textarea>
				
				<p>Change the numbers in the green boxes to see what numbers are created by the Rational constructor.
				</p>
				
				<p>Rational();
				</p>
				<p class="outlet htmlOutlet readOnly">Creates a rational number <b>0/1</b>.</p>
				
				<p>Rational(<span id="ratIn3"></span>);
				</p>
				<p id="ratOut2"></p>
				
				
				
				<p>Rational(<span id="ratIn1"></span>, 
				<span id="ratIn2"></span>);
				</p>
				<p id="ratOut"></p>
				
			</div>

		</div>

		<script>
			
			$(document).ready(function() {

				
				var gcd = function(a,b){
					if (b == 0){
						return a;
					}
					else{
						return gcd(b, a % b);
					}
				};
				
				var myFunc = function(cmd, p, q){
				
					var regex = /(^-?[1-9]\d*$)|^0$/;
					if (regex.test(p) && regex.test(q)){
						p = parseInt(p);
						q = parseInt(q);
						
						var bleh = (p > 0 ? 1 : p < 0 ? -1 : 0);
						var blah = (q > 0 ? 1 : q < 0 ? -1 : 0);
						
						p = Math.abs(p);
						q = Math.abs(q);
						
						var messages = [];
						
						if (bleh == 0 && blah == 0){
							
						}
						else if (bleh == 0){
							messages.push("All numbers equivalent to zero reduce to 0/1.");
							q = 1; blah = 1;
						}
						else{
							if (blah == -1){
								if(bleh == 1){
									messages.push("The negative sign was moved to keep q positive.");
									bleh = -1; blah = 1;
								}
								else{ //if (bleh == -1){
									messages.push("The negative signs have been canceled out.");
									bleh = 1; blah = 1;
								}
							}
							
							var g = gcd(p,q);
							
							if (g != 1 && q != 0){
								messages.push("The greatest common factor (" + g +") of p and q was divided out.");
								p = p / g;
								q = q / g;
							}
							if (q == 1){
								messages.push("Whenever p/q is equivalent to an integer, q must be 1.");
							}
							
							// can assume here p != 0
							if (q == 0 && !(p == 1)){
								messages.push("If q is 0, p is reduced to -1, 0, or 1 according to the original sign of p.");
								p = 1;
							}
						}
						
						var qzeromsg = q != 0 ? "" : (bleh > 0 ? " (positive infinity)" : bleh < 0 ? " (negative infinity)" : " (undefined)");
						var qonemsg = q != 1 ? "" : " (the integer " + bleh*p + ")";
						
						var res = "Creates a rational number <b>" + bleh*p + "/" + blah*q + "</b>" + qzeromsg + qonemsg + ".";
						if (messages.length > 0){
							res += "<ul><li>" + messages.join("</li><li>") + "</li></ul>";
						}
						return res;
					}
					else{
						return "Invalid input.";
					}
					
				};
				
				var ratIn1 = ValueEntity.instance("3");
				var ratIn2 = ValueEntity.instance("4");
				var ratIn1Outlet = HtmlOutlet.instance($("#ratIn1"), false, ratIn1);
				var ratIn2Outlet = HtmlOutlet.instance($("#ratIn2"), false, ratIn2);
				
				
				var calcOut = HtmlOutlet.instance($("#ratOut"), true);
				
				
				calcOut.setInterpreter("value", function(cmd){
					return myFunc(cmd, ratIn1.value(), ratIn2.value());
				});
				calcOut.setEntity("param1", ratIn1, "value");
				calcOut.setEntity("param2", ratIn2, "value");
				
				
				var ratIn3 = ValueEntity.instance(2);
				var ratIn3Outlet = HtmlOutlet.instance($("#ratIn3"), false, ratIn3);
				
				var calcOut2 = HtmlOutlet.instance($("#ratOut2"), true);
				calcOut2.setInterpreter("value", function(cmd){
					return myFunc(cmd, ratIn3.value(), 1);
				});
				calcOut2.setEntity("param1", ratIn3, "value");

				createDefaultOutlets();

			});
		</script>
	</body>
</html>
